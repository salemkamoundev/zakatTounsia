import{e as ne,f as re,g as _,i as oe,j as le,k as se,l as h,n as me}from"./chunk-AL6N6HL6.js";import{$ as f,Ba as ae,Da as z,G as l,J as V,K as P,L as b,M as c,N as m,O as a,P as t,Q as o,R as B,S as O,T as N,U as Z,V as d,W as G,Y as r,_ as x,aa as D,ba as F,ca as L,e as g,fa as $,ga as U,ha as q,ia as H,l as A,m as T,n as M,oa as J,q as R,qa as K,r as v,ra as Q,sa as W,ta as X,u as p,va as Y,wa as ee,xa as te,y as w,ya as ie,z as I}from"./chunk-WJXPAQLL.js";var k=class n{firestore=p(_);getNissab(){let i=h(this.firestore,"configurations/daily_values");return oe(i).pipe(T(e=>e),M(e=>(console.error("Erreur Firestore:",e),A({goldPrice:0,nissabZakat:0,lastUpdated:null}))))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})};function ue(n,i){if(n&1){let e=N();a(0,"div")(1,"button",10),Z("click",function(){w(e);let u=d();return I(u.auth.logout())}),o(2,"i",11),t()()}}function pe(n,i){n&1&&(a(0,"div",12),o(1,"div",13),a(2,"div"),r(3,"Chargement des taux..."),t()())}function fe(n,i){if(n&1&&(a(0,"div",43)(1,"div",44),o(2,"i",45),t(),a(3,"h3",46),r(4,"Zakat Due"),t(),a(5,"h1",47),r(6),f(7,"number"),a(8,"span",48),r(9,"DT"),t()(),a(10,"p",49),r(11,"Macha Allah, purifiez vos biens."),t()()),n&2){let e=d(2);l(6),x("",F(7,1,e.zakatAmount,"1.3-3")," ")}}function ge(n,i){n&1&&(a(0,"div",50)(1,"div",51),o(2,"i",52),t(),a(3,"h4",49),r(4,"Non Imposable"),t(),a(5,"p",53),r(6,"Votre net est inf\xE9rieur au Nissab."),t()())}function ve(n,i){if(n&1){let e=N();B(0),a(1,"button",56),Z("click",function(){let u=w(e).ngIf,E=d(3);return I(E.sauvegarderResultat(u))}),o(2,"i",57),r(3," Enregistrer le calcul "),t(),O()}}function be(n,i){n&1&&(a(0,"a",58),r(1,"Se connecter pour sauvegarder"),t())}function xe(n,i){if(n&1&&(a(0,"div",54),c(1,ve,4,0,"ng-container",55),f(2,"async"),c(3,be,2,0,"ng-template",null,0,L),t()),n&2){let e=G(4),s=d(2);l(),m("ngIf",D(2,2,s.auth.user$))("ngIfElse",e)}}function _e(n,i){if(n&1&&(a(0,"div")(1,"div",14),o(2,"i",15),a(3,"div",16)(4,"span",17),r(5,"Seuil du Nissab (Aujourd'hui)"),t(),a(6,"div",18),r(7),f(8,"number"),a(9,"span",19),r(10,"DT"),t()()(),a(11,"div",20)(12,"div",21),r(13,"Or 24k"),t(),a(14,"div",22),r(15),t()()(),a(16,"form",23)(17,"div",24)(18,"label",25),r(19,"\xC9pargne & Cash"),t(),a(20,"div",26)(21,"span",27),o(22,"i",28),t(),o(23,"input",29),t()(),a(24,"div",24)(25,"label",25),r(26,"Or (Grammes)"),t(),a(27,"div",26)(28,"span",27),o(29,"i",30),t(),o(30,"input",31),t()(),a(31,"div",24)(32,"label",25),r(33,"Argent Pr\xEAt\xE9"),t(),a(34,"div",26)(35,"span",27),o(36,"i",32),t(),o(37,"input",33),t()(),a(38,"div",24)(39,"label",34),r(40,"Dettes \xE0 d\xE9duire"),t(),a(41,"div",26)(42,"span",35),o(43,"i",36),t(),o(44,"input",37),t()()(),o(45,"hr",38),a(46,"div",39),c(47,fe,12,4,"div",40)(48,ge,7,0,"div",41)(49,xe,5,4,"div",42),t()()),n&2){let e=d();l(7),x("",F(8,6,e.dailyValues==null?null:e.dailyValues.nissabZakat,"1.0-0")," "),l(8),x("",e.dailyValues==null?null:e.dailyValues.goldPrice," DT/g"),l(),m("formGroup",e.zakatForm),l(31),m("ngIf",e.isEligible),l(),m("ngIf",!e.isEligible),l(),m("ngIf",e.isEligible)}}var y=class n{constructor(i,e){this.fb=i;this.zakatService=e;this.zakatForm=this.fb.group({epargne:[0],or_grammes:[0],argent_prete:[0],dettes:[0]})}zakatForm;dailyValues=null;zakatAmount=0;isEligible=!1;isLoading=!0;firestore=p(_);auth=p(ne);ngOnInit(){this.zakatService.getNissab().subscribe(i=>g(this,null,function*(){if(this.isLoading=!1,!i||!i.nissabZakat){console.warn("\u26A0\uFE0F Configuration manquante. Cr\xE9ation des valeurs par d\xE9faut..."),yield this.creerValeursParDefaut();return}this.dailyValues=i,console.log("\u2705 Valeurs du jour charg\xE9es:",this.dailyValues),this.calculer()})),this.zakatForm.valueChanges.subscribe(()=>this.calculer())}creerValeursParDefaut(){return g(this,null,function*(){try{let i={goldPrice:250,nissabZakat:21250,lastUpdated:new Date().toISOString()},e=h(this.firestore,"configurations/daily_values");yield me(e,i),console.log("\u2705 Valeurs par d\xE9faut cr\xE9\xE9es avec succ\xE8s !")}catch(i){console.error("\u274C Erreur lors de la cr\xE9ation des valeurs:",i)}})}calculer(){if(!this.dailyValues)return;let i=this.zakatForm.value,e=Number(i.epargne)||0,s=Number(i.or_grammes)||0,u=Number(i.argent_prete)||0,E=Number(i.dettes)||0,S=e+s*this.dailyValues.goldPrice+u-E;console.log(`Calcul: Net (${S}) vs Nissab (${this.dailyValues.nissabZakat})`),S>=this.dailyValues.nissabZakat?(this.isEligible=!0,this.zakatAmount=S*.025):(this.isEligible=!1,this.zakatAmount=0)}sauvegarderResultat(i){return g(this,null,function*(){if(i)try{let e={userId:i.uid,date:re.now(),inputs:this.zakatForm.value,zakatAmount:this.zakatAmount,isEligible:this.isEligible,nissabUsed:this.dailyValues?.nissabZakat};yield le(se(this.firestore,`users/${i.uid}/zakat_calculations`),e),alert("\u2705 Calcul sauvegard\xE9 !")}catch(e){console.error(e),alert("\u274C Erreur de sauvegarde")}})}static \u0275fac=function(e){return new(e||n)(V(te),V(k))};static \u0275cmp=P({type:n,selectors:[["app-zakat-calculator"]],standalone:!1,decls:13,vars:5,consts:[["loginBtn",""],[1,"row","justify-content-center"],[1,"col-lg-9"],[1,"card","card-custom"],[1,"card-header-custom","d-flex","justify-content-between","align-items-center"],[1,"h4","mb-0",2,"color","#0F5132"],[1,"fas","fa-hand-holding-heart","me-2","text-warning"],[4,"ngIf"],[1,"card-body","p-4","p-lg-5"],["class","text-center py-5 text-muted",4,"ngIf"],["title","D\xE9connexion",1,"btn","btn-sm","btn-outline-danger","rounded-circle",3,"click"],[1,"fas","fa-power-off"],[1,"text-center","py-5","text-muted"],["role","status",1,"spinner-border","text-success","mb-3"],[1,"d-flex","align-items-center","justify-content-between","p-4","mb-5","rounded-4","text-white",2,"background","linear-gradient(135deg, #0F5132 0%, #0b3d26 100%)","position","relative","overflow","hidden"],[1,"fas","fa-kaaba","position-absolute","text-white","opacity-25",2,"font-size","10rem","right","-20px","top","-20px"],[1,"position-relative","z-1"],[1,"text-warning","text-uppercase","small","fw-bold","ls-1"],[1,"display-5","fw-bold","font-monospace"],[1,"fs-4"],[1,"text-end","position-relative","z-1","d-none","d-sm-block"],[1,"badge","bg-warning","text-dark","mb-1"],[1,"fw-bold"],[1,"row","g-4",3,"formGroup"],[1,"col-md-6"],[1,"form-label","text-muted","small","fw-bold","text-uppercase"],[1,"input-group"],[1,"input-group-text"],[1,"fas","fa-wallet"],["type","number","formControlName","epargne","placeholder","0",1,"form-control"],[1,"fas","fa-ring"],["type","number","formControlName","or_grammes","placeholder","0",1,"form-control"],[1,"fas","fa-hand-holding-usd"],["type","number","formControlName","argent_prete","placeholder","0",1,"form-control"],[1,"form-label","text-danger","small","fw-bold","text-uppercase"],[1,"input-group-text","text-danger","border-danger"],[1,"fas","fa-file-invoice-dollar"],["type","number","formControlName","dettes","placeholder","0",1,"form-control","border-danger","text-danger"],[1,"my-5","opacity-10"],[1,"text-center"],["class","animate-bounce",4,"ngIf"],["class","opacity-75",4,"ngIf"],["class","mt-4 pt-3 border-top",4,"ngIf"],[1,"animate-bounce"],[1,"d-inline-block","p-4","rounded-circle","bg-success","text-white","shadow","mb-3",2,"width","80px","height","80px","display","grid","place-items","center"],[1,"fas","fa-check","fa-2x"],[1,"text-success","mb-0"],[1,"display-3","fw-bold","text-dark","mb-2"],[1,"fs-4","text-muted"],[1,"text-muted"],[1,"opacity-75"],[1,"d-inline-block","p-3","rounded-circle","bg-light","text-muted","mb-3"],[1,"fas","fa-minus","fa-2x"],[1,"small","text-muted"],[1,"mt-4","pt-3","border-top"],[4,"ngIf","ngIfElse"],[1,"btn","btn-emerald","w-100","py-3",3,"click"],[1,"fas","fa-save","me-2"],["routerLink","/login",1,"btn","btn-gold-outline","w-100"]],template:function(e,s){e&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),o(6,"i",6),r(7,"Ma Zakat"),t()(),c(8,ue,3,0,"div",7),f(9,"async"),t(),a(10,"div",8),c(11,pe,4,0,"div",9)(12,_e,50,9,"div",7),t()()()()),e&2&&(l(8),m("ngIf",D(9,3,s.auth.user$)),l(3),m("ngIf",s.isLoading),l(),m("ngIf",!s.isLoading))},dependencies:[$,ae,W,J,X,K,Q,Y,ee,U,q],encapsulation:2})};var he=[{path:"",component:y}],C=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=b({type:n});static \u0275inj=v({imports:[z.forChild(he),z]})};var ce=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=b({type:n});static \u0275inj=v({imports:[H,C,ie]})};export{ce as ZakatModule};
