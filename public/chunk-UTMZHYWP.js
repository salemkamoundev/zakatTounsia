import{e as se,f as ce,g as y,i as me,j as pe,k as de,l as k,n as ue}from"./chunk-GHCPQYKQ.js";import{$ as v,Aa as ae,Ba as ne,Ea as re,Fa as oe,G as r,Ia as le,K as N,Ka as D,L as R,M as h,N as u,O as d,P as n,Q as a,R as s,S as M,T as G,U as Z,V,W as f,X as O,Z as o,_ as m,aa as l,ba as c,ca as B,da as K,e as x,ga as U,ha as $,ia as q,ja as Y,l as z,m as L,n as P,q as j,qa as H,r as _,sa as J,ta as Q,u as b,ua as W,va as X,xa as ee,y as w,ya as te,z as T,za as ie}from"./chunk-SBQ7ARBD.js";var C=class t{firestore=b(y);getNissab(){let i=k(this.firestore,"configurations/daily_values");return me(i).pipe(L(e=>e),P(e=>(console.error("Erreur Firestore:",e),z({goldPrice:0,nissabZakat:0,lastUpdated:null}))))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=j({token:t,factory:t.\u0275fac,providedIn:"root"})};function ge(t,i){if(t&1){let e=Z();n(0,"div")(1,"button",9),V("click",function(){w(e);let g=f();return T(g.auth.logout())}),s(2,"i",10),a()()}}function be(t,i){if(t&1&&(n(0,"div",40)(1,"div",41),s(2,"i",42),a(),n(3,"h3",43),o(4),l(5,"translate"),a(),n(6,"p",44),o(7),l(8,"translate"),a(),n(9,"h1",45),o(10),l(11,"number"),n(12,"span",46),o(13,"DT"),a()()()),t&2){let e=f(2);r(4),m(c(5,3,"ZAKAT.RESULT_ELIGIBLE")),r(3),m(c(8,5,"ZAKAT.PAY_AMOUNT")),r(3),v("",B(11,7,e.zakatAmount,"1.3-3")," ")}}function xe(t,i){t&1&&(n(0,"div",47)(1,"h4",44),o(2),l(3,"translate"),a()()),t&2&&(r(2),m(c(3,1,"ZAKAT.RESULT_NOT_ELIGIBLE")))}function _e(t,i){if(t&1){let e=Z();M(0),n(1,"button",50),V("click",function(){let g=w(e).ngIf,S=f(3);return T(S.sauvegarderResultat(g))}),s(2,"i",51),o(3),l(4,"translate"),a(),G()}t&2&&(r(3),v(" ",c(4,1,"ZAKAT.SAVE_BTN")," "))}function he(t,i){t&1&&(n(0,"a",52),o(1),l(2,"translate"),a()),t&2&&(r(),m(c(2,1,"NAV.LOGIN")))}function ye(t,i){if(t&1&&(n(0,"div",48),u(1,_e,5,3,"ng-container",49),l(2,"async"),u(3,he,3,3,"ng-template",null,0,K),a()),t&2){let e=O(4),p=f(2);r(),d("ngIf",c(2,2,p.auth.user$))("ngIfElse",e)}}function ke(t,i){if(t&1&&(n(0,"div")(1,"div",11),s(2,"i",12),n(3,"div",13)(4,"span",14),o(5),l(6,"translate"),a(),n(7,"div",15),o(8),l(9,"number"),n(10,"span",16),o(11,"DT"),a()()(),n(12,"div",17)(13,"div",18),o(14),l(15,"translate"),a(),n(16,"div",19),o(17),a()()(),n(18,"form",20)(19,"div",21)(20,"label",22),o(21),l(22,"translate"),a(),n(23,"div",23)(24,"span",24),s(25,"i",25),a(),s(26,"input",26),a()(),n(27,"div",21)(28,"label",22),o(29),l(30,"translate"),a(),n(31,"div",23)(32,"span",24),s(33,"i",27),a(),s(34,"input",28),a()(),n(35,"div",21)(36,"label",22),o(37),l(38,"translate"),a(),n(39,"div",23)(40,"span",24),s(41,"i",29),a(),s(42,"input",30),a()(),n(43,"div",21)(44,"label",31),o(45),l(46,"translate"),a(),n(47,"div",23)(48,"span",32),s(49,"i",33),a(),s(50,"input",34),a()()(),s(51,"hr",35),n(52,"div",36),u(53,be,14,10,"div",37)(54,xe,4,3,"div",38)(55,ye,5,4,"div",39),a()()),t&2){let e=f();r(5),m(c(6,12,"ZAKAT.NISSAB_LABEL")),r(3),v("",B(9,14,e.dailyValues==null?null:e.dailyValues.nissabZakat,"1.0-0")," "),r(6),m(c(15,17,"ZAKAT.GOLD_PRICE")),r(3),v("",e.dailyValues==null?null:e.dailyValues.goldPrice," DT/g"),r(),d("formGroup",e.zakatForm),r(3),m(c(22,19,"ZAKAT.INPUT_SAVINGS")),r(8),m(c(30,21,"ZAKAT.INPUT_GOLD")),r(8),m(c(38,23,"ZAKAT.INPUT_LOANS")),r(8),m(c(46,25,"ZAKAT.INPUT_DEBTS")),r(8),d("ngIf",e.isEligible),r(),d("ngIf",!e.isEligible),r(),d("ngIf",e.isEligible)}}var E=class t{constructor(i,e){this.fb=i;this.zakatService=e;this.zakatForm=this.fb.group({epargne:[0],or_grammes:[0],argent_prete:[0],dettes:[0]})}zakatForm;dailyValues=null;zakatAmount=0;isEligible=!1;isLoading=!0;firestore=b(y);auth=b(se);ngOnInit(){this.zakatService.getNissab().subscribe(i=>x(this,null,function*(){if(this.isLoading=!1,!i||!i.nissabZakat){console.warn("\u26A0\uFE0F Configuration manquante. Cr\xE9ation des valeurs par d\xE9faut..."),yield this.creerValeursParDefaut();return}this.dailyValues=i,console.log("\u2705 Valeurs du jour charg\xE9es:",this.dailyValues),this.calculer()})),this.zakatForm.valueChanges.subscribe(()=>this.calculer())}creerValeursParDefaut(){return x(this,null,function*(){try{let i={goldPrice:250,nissabZakat:21250,lastUpdated:new Date().toISOString()},e=k(this.firestore,"configurations/daily_values");yield ue(e,i),console.log("\u2705 Valeurs par d\xE9faut cr\xE9\xE9es avec succ\xE8s !")}catch(i){console.error("\u274C Erreur lors de la cr\xE9ation des valeurs:",i)}})}calculer(){if(!this.dailyValues)return;let i=this.zakatForm.value,e=Number(i.epargne)||0,p=Number(i.or_grammes)||0,g=Number(i.argent_prete)||0,S=Number(i.dettes)||0,A=e+p*this.dailyValues.goldPrice+g-S;console.log(`Calcul: Net (${A}) vs Nissab (${this.dailyValues.nissabZakat})`),A>=this.dailyValues.nissabZakat?(this.isEligible=!0,this.zakatAmount=A*.025):(this.isEligible=!1,this.zakatAmount=0)}sauvegarderResultat(i){return x(this,null,function*(){if(i)try{let e={userId:i.uid,date:ce.now(),inputs:this.zakatForm.value,zakatAmount:this.zakatAmount,isEligible:this.isEligible,nissabUsed:this.dailyValues?.nissabZakat};yield pe(de(this.firestore,`users/${i.uid}/zakat_calculations`),e),alert("\u2705 Calcul sauvegard\xE9 !")}catch(e){console.error(e),alert("\u274C Erreur de sauvegarde")}})}static \u0275fac=function(e){return new(e||t)(N(ie),N(C))};static \u0275cmp=R({type:t,selectors:[["app-zakat-calculator"]],standalone:!1,decls:13,vars:7,consts:[["loginBtn",""],[1,"row","justify-content-center"],[1,"col-lg-9"],[1,"card","card-custom"],[1,"card-header-custom","d-flex","justify-content-between","align-items-center"],[1,"h4","mb-0",2,"color","#0F5132"],[1,"fas","fa-hand-holding-heart","me-2","text-warning"],[4,"ngIf"],[1,"card-body","p-4","p-lg-5"],[1,"btn","btn-sm","btn-outline-danger","rounded-circle",3,"click"],[1,"fas","fa-power-off"],[1,"d-flex","align-items-center","justify-content-between","p-4","mb-5","rounded-4","text-white",2,"background","linear-gradient(135deg, #0F5132 0%, #0b3d26 100%)","position","relative","overflow","hidden"],[1,"fas","fa-kaaba","position-absolute","text-white","opacity-25",2,"font-size","10rem","right","-20px","top","-20px"],[1,"position-relative","z-1"],[1,"text-warning","text-uppercase","small","fw-bold","ls-1"],[1,"display-5","fw-bold","font-monospace"],[1,"fs-4"],[1,"text-end","position-relative","z-1","d-none","d-sm-block"],[1,"badge","bg-warning","text-dark","mb-1"],[1,"fw-bold"],[1,"row","g-4",3,"formGroup"],[1,"col-md-6"],[1,"form-label","text-muted","small","fw-bold","text-uppercase"],[1,"input-group"],[1,"input-group-text"],[1,"fas","fa-wallet"],["type","number","formControlName","epargne","placeholder","0",1,"form-control"],[1,"fas","fa-ring"],["type","number","formControlName","or_grammes","placeholder","0",1,"form-control"],[1,"fas","fa-hand-holding-usd"],["type","number","formControlName","argent_prete","placeholder","0",1,"form-control"],[1,"form-label","text-danger","small","fw-bold","text-uppercase"],[1,"input-group-text","text-danger","border-danger"],[1,"fas","fa-file-invoice-dollar"],["type","number","formControlName","dettes","placeholder","0",1,"form-control","border-danger","text-danger"],[1,"my-5","opacity-10"],[1,"text-center"],["class","animate-bounce",4,"ngIf"],["class","opacity-75",4,"ngIf"],["class","mt-4 pt-3 border-top",4,"ngIf"],[1,"animate-bounce"],[1,"d-inline-block","p-4","rounded-circle","bg-success","text-white","shadow","mb-3",2,"width","80px","height","80px","display","grid","place-items","center"],[1,"fas","fa-check","fa-2x"],[1,"text-success","mb-0"],[1,"text-muted"],[1,"display-3","fw-bold","text-dark","mb-2"],[1,"fs-4","text-muted"],[1,"opacity-75"],[1,"mt-4","pt-3","border-top"],[4,"ngIf","ngIfElse"],[1,"btn","btn-emerald","w-100","py-3",3,"click"],[1,"fas","fa-save","me-2"],["routerLink","/login",1,"btn","btn-gold-outline","w-100"]],template:function(e,p){e&1&&(n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),s(6,"i",6),o(7),l(8,"translate"),a()(),u(9,ge,3,0,"div",7),l(10,"async"),a(),n(11,"div",8),u(12,ke,56,27,"div",7),a()()()()),e&2&&(r(7),v("",c(8,3,"ZAKAT.TITLE")," "),r(2),d("ngIf",c(10,5,p.auth.user$)),r(3),d("ngIf",!p.isLoading))},dependencies:[U,le,W,H,X,J,Q,ee,te,$,q,re],encapsulation:2})};var Ce=[{path:"",component:E}],I=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=h({type:t});static \u0275inj=_({imports:[D.forChild(Ce),D]})};var fe=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=h({type:t});static \u0275inj=_({imports:[Y,I,ne,ae,oe.forChild()]})};export{fe as ZakatModule};
